<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>팀 협업 - TaskFlow Enterprise</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles-enterprise.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div class="team-view-container">
        <!-- Team Header -->
        <div class="team-header-section">
            <div class="team-info">
                <h1>팀 협업 대시보드</h1>
                <p class="team-description">팀원들과 함께 업무를 관리하고 협업하세요</p>
            </div>
            <div class="team-actions">
                <button class="btn-enterprise btn-secondary" onclick="showCreateTeamModal()">
                    <i class="fas fa-plus-circle"></i>
                    새 팀 만들기
                </button>
                <button class="btn-enterprise btn-primary" onclick="showInviteModal()">
                    <i class="fas fa-user-plus"></i>
                    팀원 초대
                </button>
            </div>
        </div>

        <!-- Team Stats -->
        <div class="team-stats-grid">
            <div class="team-stat-card">
                <div class="stat-icon" style="background: rgba(90, 99, 234, 0.1); color: var(--primary-600);">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="teamMemberCount">0</div>
                    <div class="stat-label">팀원</div>
                </div>
            </div>
            
            <div class="team-stat-card">
                <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success-main);">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="activeTaskCount">0</div>
                    <div class="stat-label">진행중인 업무</div>
                </div>
            </div>
            
            <div class="team-stat-card">
                <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning-main);">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="todayActivityCount">0</div>
                    <div class="stat-label">오늘의 활동</div>
                </div>
            </div>
            
            <div class="team-stat-card">
                <div class="stat-icon" style="background: rgba(59, 130, 246, 0.1); color: var(--info-main);">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="teamProductivity">0%</div>
                    <div class="stat-label">팀 생산성</div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="team-content-grid">
            <!-- Team Members Section -->
            <div class="card-enterprise">
                <div class="card-header">
                    <h2>팀원</h2>
                    <input type="text" class="form-input" placeholder="팀원 검색..." style="max-width: 200px;" onkeyup="filterTeamMembers(this.value)">
                </div>
                <div class="card-body">
                    <div id="teamMembersList" class="team-members-grid">
                        <!-- Team members will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Team Tasks Section -->
            <div class="card-enterprise" style="grid-column: span 2;">
                <div class="card-header">
                    <h2>팀 업무</h2>
                    <div class="filter-tabs">
                        <button class="filter-tab active" onclick="filterTeamTasks('all')">전체</button>
                        <button class="filter-tab" onclick="filterTeamTasks('assigned')">내 업무</button>
                        <button class="filter-tab" onclick="filterTeamTasks('unassigned')">미할당</button>
                        <button class="filter-tab" onclick="filterTeamTasks('overdue')">지연</button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="teamTasksList" class="team-tasks-list">
                        <!-- Team tasks will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Recent Activity Section -->
            <div class="card-enterprise">
                <div class="card-header">
                    <h2>최근 활동</h2>
                </div>
                <div class="card-body">
                    <div id="recentActivityList" class="activity-timeline">
                        <!-- Recent activities will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Team Modal -->
    <div class="modal-backdrop" id="createTeamModal" style="display: none;">
        <div class="modal-content animate-scaleIn" style="max-width: 500px;">
            <div class="modal-header">
                <h2>새 팀 만들기</h2>
                <button class="btn-enterprise btn-ghost" onclick="closeCreateTeamModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="createTeamForm" onsubmit="createTeam(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">팀 이름 *</label>
                        <input type="text" class="form-input" id="teamName" required placeholder="예: 프로덕트 개발팀">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">팀 설명</label>
                        <textarea class="form-input" id="teamDescription" rows="3" placeholder="팀의 목표와 역할을 설명해주세요"></textarea>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-enterprise btn-secondary" onclick="closeCreateTeamModal()">
                        취소
                    </button>
                    <button type="submit" class="btn-enterprise btn-primary">
                        <i class="fas fa-check"></i>
                        팀 만들기
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
    // Team View Management
    let currentTeam = null;
    let teamMembers = [];
    let teamTasks = [];

    // Initialize team view
    async function initTeamView() {
        await loadTeamData();
        await loadTeamMembers();
        await loadTeamTasks();
        await loadRecentActivity();
        updateTeamStats();
    }

    async function loadTeamData() {
        try {
            const teams = await apiClient.getTeams();
            if (teams && teams.length > 0) {
                currentTeam = teams[0];
                updateTeamHeader();
            }
        } catch (error) {
            console.error('Failed to load team data:', error);
        }
    }

    async function loadTeamMembers() {
        if (!currentTeam) return;
        
        try {
            teamMembers = await apiClient.getTeamMembers(currentTeam.id);
            renderTeamMembers();
        } catch (error) {
            console.error('Failed to load team members:', error);
        }
    }

    async function loadTeamTasks() {
        try {
            // Load all tasks (in real app, would filter by team)
            teamTasks = await apiClient.getTasks();
            renderTeamTasks(teamTasks);
        } catch (error) {
            console.error('Failed to load team tasks:', error);
        }
    }

    async function loadRecentActivity() {
        // Simulate recent activity
        const activities = [
            {
                type: 'task_completed',
                user: '김개발',
                action: '업무를 완료했습니다',
                target: 'API 문서 작성',
                time: '10분 전',
                icon: 'check-circle',
                color: 'success'
            },
            {
                type: 'comment_added',
                user: '이디자인',
                action: '댓글을 남겼습니다',
                target: 'UI 컴포넌트 디자인',
                time: '30분 전',
                icon: 'comment',
                color: 'info'
            },
            {
                type: 'task_assigned',
                user: '박매니저',
                action: '업무를 할당했습니다',
                target: '마케팅 캠페인 기획',
                time: '1시간 전',
                icon: 'user-plus',
                color: 'primary'
            },
            {
                type: 'member_joined',
                user: '최개발',
                action: '팀에 참여했습니다',
                target: '',
                time: '2시간 전',
                icon: 'users',
                color: 'primary'
            }
        ];
        
        renderRecentActivity(activities);
    }

    function updateTeamHeader() {
        if (currentTeam) {
            document.querySelector('.team-info h1').textContent = currentTeam.name || '팀 협업 대시보드';
            document.querySelector('.team-description').textContent = currentTeam.description || '팀원들과 함께 업무를 관리하고 협업하세요';
        }
    }

    function updateTeamStats() {
        document.getElementById('teamMemberCount').textContent = teamMembers.length;
        document.getElementById('activeTaskCount').textContent = teamTasks.filter(t => t.status === 'in_progress').length;
        document.getElementById('todayActivityCount').textContent = Math.floor(Math.random() * 20) + 10;
        document.getElementById('teamProductivity').textContent = Math.floor(Math.random() * 30) + 70 + '%';
    }

    function renderTeamMembers() {
        const container = document.getElementById('teamMembersList');
        container.innerHTML = teamMembers.map(member => `
            <div class="team-member-card animate-fadeIn">
                <div class="member-avatar-large" style="background: ${getAvatarColor(member.username)}">
                    ${getInitials(member.username)}
                </div>
                <div class="member-details">
                    <h4>${member.username}</h4>
                    <p class="member-email">${member.email}</p>
                    <span class="member-role-badge ${member.role === 'admin' ? 'role-admin' : 'role-member'}">
                        ${member.role === 'admin' ? '관리자' : '팀원'}
                    </span>
                </div>
                <div class="member-stats">
                    <div class="mini-stat">
                        <span class="mini-stat-value">${Math.floor(Math.random() * 10) + 5}</span>
                        <span class="mini-stat-label">진행중</span>
                    </div>
                    <div class="mini-stat">
                        <span class="mini-stat-value">${Math.floor(Math.random() * 20) + 10}</span>
                        <span class="mini-stat-label">완료</span>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function renderTeamTasks(tasks) {
        const container = document.getElementById('teamTasksList');
        
        if (tasks.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--gray-500); padding: 3rem;">업무가 없습니다</p>';
            return;
        }
        
        container.innerHTML = tasks.map(task => `
            <div class="team-task-item animate-fadeIn">
                <div class="task-checkbox-wrapper">
                    <input type="checkbox" class="task-checkbox" ${task.status === 'completed' ? 'checked' : ''}>
                </div>
                <div class="task-content">
                    <div class="task-title">${task.title}</div>
                    <div class="task-meta">
                        <span class="task-priority-badge priority-${task.priority}">${task.priority}</span>
                        ${task.category_name ? `<span><i class="fas fa-folder"></i> ${task.category_name}</span>` : ''}
                        ${task.due_date ? `<span><i class="fas fa-clock"></i> ${formatDate(task.due_date)}</span>` : ''}
                        ${task.assignee ? `<span><i class="fas fa-user"></i> ${task.assignee}</span>` : '<span style="color: var(--warning-main);"><i class="fas fa-exclamation-circle"></i> 미할당</span>'}
                    </div>
                </div>
                <div class="task-actions">
                    <button class="btn-enterprise btn-ghost btn-sm" onclick="showTaskDetail(${task.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-enterprise btn-ghost btn-sm" onclick="showAssignModal(${task.id})">
                        <i class="fas fa-user-plus"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }

    function renderRecentActivity(activities) {
        const container = document.getElementById('recentActivityList');
        container.innerHTML = activities.map(activity => `
            <div class="activity-item animate-fadeIn">
                <div class="activity-icon-wrapper ${activity.color}">
                    <i class="fas fa-${activity.icon}"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-text">
                        <strong>${activity.user}</strong> ${activity.action}
                        ${activity.target ? `<span class="activity-target">${activity.target}</span>` : ''}
                    </div>
                    <div class="activity-time">${activity.time}</div>
                </div>
            </div>
        `).join('');
    }

    // Filter functions
    function filterTeamMembers(query) {
        const filtered = teamMembers.filter(member => 
            member.username.toLowerCase().includes(query.toLowerCase()) ||
            member.email.toLowerCase().includes(query.toLowerCase())
        );
        renderTeamMembers(filtered);
    }

    function filterTeamTasks(filter) {
        // Update active tab
        document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
        event.target.classList.add('active');
        
        let filtered = teamTasks;
        
        switch(filter) {
            case 'assigned':
                // In real app, filter by current user
                filtered = teamTasks.filter(t => t.assignee);
                break;
            case 'unassigned':
                filtered = teamTasks.filter(t => !t.assignee);
                break;
            case 'overdue':
                filtered = teamTasks.filter(t => {
                    if (!t.due_date) return false;
                    return new Date(t.due_date) < new Date() && t.status !== 'completed';
                });
                break;
        }
        
        renderTeamTasks(filtered);
    }

    // Modal functions
    function showCreateTeamModal() {
        document.getElementById('createTeamModal').style.display = 'flex';
    }

    function closeCreateTeamModal() {
        document.getElementById('createTeamModal').style.display = 'none';
        document.getElementById('createTeamForm').reset();
    }

    async function createTeam(event) {
        event.preventDefault();
        
        const teamData = {
            name: document.getElementById('teamName').value,
            description: document.getElementById('teamDescription').value
        };
        
        try {
            const team = await apiClient.createTeam(teamData);
            if (window.app) {
                window.app.showNotification('팀이 생성되었습니다', 'success');
            }
            closeCreateTeamModal();
            await loadTeamData();
        } catch (error) {
            if (window.app) {
                window.app.showNotification('팀 생성 실패: ' + error.message, 'error');
            }
        }
    }

    function showInviteModal() {
        if (window.collaboration) {
            window.collaboration.showInviteModal();
        }
    }

    function showTaskDetail(taskId) {
        if (window.parent && window.parent.showTaskDetail) {
            window.parent.showTaskDetail(taskId);
        }
    }

    function showAssignModal(taskId) {
        if (window.app) {
            window.app.showNotification('업무 할당 기능은 준비 중입니다', 'info');
        }
    }

    // Helper functions
    function getInitials(name) {
        return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
    }

    function getAvatarColor(name) {
        const colors = ['#5A63EA', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#6366F1'];
        let hash = 0;
        for (let i = 0; i < name.length; i++) {
            hash = name.charCodeAt(i) + ((hash << 5) - hash);
        }
        return colors[Math.abs(hash) % colors.length];
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ko-KR');
    }

    // Make functions globally available
    window.showTeamView = function() {
        window.location.href = 'team-view.html';
    };

    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
        initTeamView();
    });
    </script>

    <style>
    /* Team View Specific Styles */
    .team-view-container {
        padding: var(--space-8);
        background: var(--gray-50);
        min-height: 100vh;
    }

    .team-header-section {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-8);
    }

    .team-info h1 {
        margin-bottom: var(--space-2);
    }

    .team-description {
        color: var(--gray-600);
        font-size: var(--text-lg);
    }

    .team-actions {
        display: flex;
        gap: var(--space-3);
    }

    .team-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--space-6);
        margin-bottom: var(--space-8);
    }

    .team-stat-card {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-xl);
        padding: var(--space-6);
        display: flex;
        align-items: center;
        gap: var(--space-4);
    }

    .team-content-grid {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: var(--space-6);
    }

    .team-members-grid {
        display: grid;
        gap: var(--space-4);
    }

    .team-member-card {
        display: flex;
        align-items: center;
        gap: var(--space-4);
        padding: var(--space-4);
        background: var(--gray-50);
        border-radius: var(--radius-lg);
        transition: all var(--transition-fast);
    }

    .team-member-card:hover {
        background: var(--gray-100);
        transform: translateY(-2px);
    }

    .member-avatar-large {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: var(--text-xl);
    }

    .member-details {
        flex: 1;
    }

    .member-details h4 {
        margin-bottom: var(--space-1);
    }

    .member-email {
        font-size: var(--text-sm);
        color: var(--gray-600);
        margin-bottom: var(--space-2);
    }

    .member-role-badge {
        display: inline-block;
        padding: var(--space-1) var(--space-3);
        border-radius: var(--radius-full);
        font-size: var(--text-xs);
        font-weight: 600;
        text-transform: uppercase;
    }

    .role-admin {
        background: var(--primary-100);
        color: var(--primary-700);
    }

    .role-member {
        background: var(--gray-100);
        color: var(--gray-700);
    }

    .member-stats {
        display: flex;
        gap: var(--space-4);
    }

    .mini-stat {
        text-align: center;
    }

    .mini-stat-value {
        display: block;
        font-size: var(--text-xl);
        font-weight: 600;
        color: var(--gray-900);
    }

    .mini-stat-label {
        display: block;
        font-size: var(--text-xs);
        color: var(--gray-600);
    }

    .team-tasks-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
    }

    .team-task-item {
        display: flex;
        align-items: center;
        gap: var(--space-4);
        padding: var(--space-4);
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        transition: all var(--transition-fast);
    }

    .team-task-item:hover {
        border-color: var(--primary-300);
        box-shadow: var(--shadow-sm);
    }

    .activity-timeline {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
    }

    .activity-item {
        display: flex;
        gap: var(--space-3);
        position: relative;
    }

    .activity-icon-wrapper {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .activity-icon-wrapper.success {
        background: var(--success-light);
        color: var(--success-dark);
    }

    .activity-icon-wrapper.info {
        background: var(--info-light);
        color: var(--info-dark);
    }

    .activity-icon-wrapper.primary {
        background: var(--primary-100);
        color: var(--primary-700);
    }

    .activity-content {
        flex: 1;
        padding-top: var(--space-2);
    }

    .activity-text {
        font-size: var(--text-sm);
        color: var(--gray-700);
        margin-bottom: var(--space-1);
    }

    .activity-target {
        color: var(--gray-900);
        font-weight: 500;
    }

    .activity-time {
        font-size: var(--text-xs);
        color: var(--gray-500);
    }

    @media (max-width: 1024px) {
        .team-content-grid {
            grid-template-columns: 1fr;
        }
        
        .team-header-section {
            flex-direction: column;
            gap: var(--space-4);
        }
    }

    @media (max-width: 640px) {
        .team-view-container {
            padding: var(--space-4);
        }
        
        .team-stats-grid {
            grid-template-columns: 1fr;
        }
        
        .team-actions {
            flex-direction: column;
            width: 100%;
        }
        
        .team-actions button {
            width: 100%;
        }
    }
    </style>

    <!-- Include necessary scripts -->
    <script src="api-client.js"></script>
</body>
</html>